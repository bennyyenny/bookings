generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// --------------------
// Company / multi-tenant
// --------------------
model Company {
  id        Int            @id @default(autoincrement())
  name      String
  slug      String         @unique

  venues    Venue[]
  users     CompanyUser[]  // only staff/admin/owners

  createdAt DateTime       @default(now())
}

// CompanyUser = user roles at company level
model CompanyUser {
  userId    Int
  companyId Int
  role      CompanyRole

  user      User    @relation(fields: [userId], references: [id])
  company   Company @relation(fields: [companyId], references: [id])

  @@id([userId, companyId])
}

// Company roles
enum CompanyRole {
  OWNER
  ADMIN
  STAFF
}

// --------------------
// Venue
// --------------------
model Venue {
  id        Int       @id @default(autoincrement())
  name      String
  slug      String
  companyId Int       // required for staff/admin venues

  company   Company   @relation(fields: [companyId], references: [id])

  bays      Bay[]
  bookings  Booking[]
  users     VenueUser[]  // optional, empty for some venues

  createdAt DateTime @default(now())

  @@unique([companyId, slug]) // slug unique per company
}

// VenueUser = user roles at venue level
model VenueUser {
  userId  Int
  venueId Int
  role    String?      // e.g., "admin", "manager", "staff"; optional

  user   User   @relation(fields: [userId], references: [id])
  venue  Venue  @relation(fields: [venueId], references: [id])

  @@id([userId, venueId])
}

// --------------------
// User
// --------------------
model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  name      String?
  
  bookings  Booking[]        // all users can have bookings
  venues    VenueUser[]      // only staff/admin assigned to venues
  companies CompanyUser[]  // optional: only staff/admins

  createdAt DateTime @default(now())
}

// --------------------
// Bay
// --------------------
model Bay {
  id        Int       @id @default(autoincrement())
  name      String
  venueId   Int
  venue     Venue     @relation(fields: [venueId], references: [id])
  bookings  Booking[]
  createdAt DateTime @default(now())
}

// --------------------
// Booking
// --------------------
model Booking {
  id        Int            @id @default(autoincrement())
  userId    Int
  bayId     Int
  venueId   Int
  startAt   DateTime
  endAt     DateTime
  status    BookingStatus @default(CONFIRMED)

  user      User    @relation(fields: [userId], references: [id])
  bay       Bay     @relation(fields: [bayId], references: [id])
  venue     Venue   @relation(fields: [venueId], references: [id])

  createdAt DateTime @default(now())

  @@index([bayId, startAt, endAt])
}

// --------------------
// Booking status
// --------------------
enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
}
